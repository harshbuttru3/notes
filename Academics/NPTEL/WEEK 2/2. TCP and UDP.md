In TCP/IP, the transport layer consists of two different protocols. 
1. Transmission control protocol (TCP).
2. User datagram protocol (UDP). 

- User processes (applications) interact with the TCP/IP protocol suite by sending/receiving TCP or UDP data.
- Both TCP and UDP in turn uses the IP layer for delivery of packets.


![[Pasted image 20250820075139.png]]

## Role of TCP 
- Provides a connection-oriented, reliable, full-duples, byte-stream service.
	- Underlying IP layer is unreliable and provides connectionless delivery service.
	- TCP provides end-to-end reliability using 
		- Checksum
		- Positive acknowledgements
		- Timeouts
		- End-to-end flow control
- TCP also handles 
	- Establishment and termination of connections between processes. 
	- Sequencing of data that might reach the destination in any arbitrary order. 

## Role of UDP
- UDP provides a connectionless and unreliable datagram service.
	- very similar to IP in this respect
	- Provides two features that are not there in IP : 
		- A checksum to verify the integrity of the UDP packet.
		- Port numbers to identify the processes at the two ends. 

## Port Numbers
- Multiple user processes on a machine may use TCP or UDP at the same time.
- There is need for a mechanism to uniquely identify the data packets associated with each process. 

- Both TCP and UDP uses 16-bit integer port numbers.
- Different applications are identified by different port numbers.
- Port numbers are stored in the headers of TCP or UDP packets.

### Client-server scenario
- By knowing the 32-bit ip address of the server host, a client host can connect to the server.
- To identify a particular process running on the server host, the client must also know the corresponding port number. 

### Well known port numbers
- Predefined, and publicly known. 
- FTP uses port 21, SMTP uses port 25
- Well-known port numbers are stored in a particular file on the host machine. 
	- Unix:: /etc/services
	- Windows:: c:\WINDOWS\system32\drivers\etc\services
	- Each line has the format:
		 `<service name> <port number>/<protocols> [aliases...] [#<comments>`

![[Pasted image 20250824223148.png]]

## Ephemeral Port numbers
A Typical scenario : 
- A client process sends a message to a server process located on some host at port 1534. 
- How will the server know where to respond?
	- Client process requests an unused port number from the TCP/UDP module on its local host. 
	- These are temporary port numbers, called ***Ephemeral port numbers***. 
	- Send along with the TCP or UDP header. 
- Port numbers from 1 to 1023 are reserved for well-known ports. 
	- Has been extended to 4095.
- Numbers beyond this and up to 65535 used as ephemeral port numbers. 

## Connection Establishment
- A hierarchical addressing scheme is used to define a connection path between two hosts. 
	- IP address
		-  Identifies the communicating hosts. 
	- Protocol identifier
		-  Identifies the transport layer protocol being used (TCP, UDP or anything else).
	- Port number
		- Identifies the communicating processes in the two hosts. 
## Association : 
- A set of five values that describe a unique process-to-process connection is called association.
	- The protocol (TCP or UDP).
	- Local host IP address (32-bit value).
	- Local port number (16-bit value).
	- Remote host IP address (32-bit value).
	- Remote port number (16-bit value).
- Example of an association : 
	 {TCP, 144.16.192.5, 1785, 144.16.202.57, 21}

## Transmission Control Protocol (TCP)
TCP supports host-to-host communication with the following features:
- Process-to-process communication
- Stream delivery service
- Full-duplex communication
- Multiplexing and de-multiplexing
- Connection-oriented reliable service
![[Pasted image 20250825034543.png]]
![[Pasted image 20250825034631.png]]
![[Pasted image 20250825034706.png]]
### TCP Header Fields 
- Source Port (16 bits)
	- Identifies the process at the local end. 
- Destination port (16 bits)
	- Identifies the process at the remote end. 
- Sequence number (32 bits)
	- Used for reliable delivery of message.
	- Each byte of message is assigned a 32-bit number that is incremented sequentially.
	- The field holds the number of the first byte in that TCP segment.
- Acknowledgement Number (32 bits) 
	- Used by remote host to acknowledge receipt of data. 
	- Contains the number of the next byte expected to be received. 
- HLEN (4 bits)
	- Specifies the header length in number of 32-bit words. 
- Flags ( 6 bits )
	- There are six Flags.
		1.  URG is set to 1 if the urgent pointer is in use. 
		2.  A connection request is sent by making SYN=1 and ACK=0.
		3. A connection is confirmed by sending SYN=1 and ACK=1.
		4. When the sender has no more data, FIN=1 is sent to release the connection.
		5. RST bit is used to reset a connection. It is also used to reject a connection attempt. 
		6. PSH bit indicates the push function. Used to indicate end message. 
- Window (16 bits )
	- Specifies how many bytes may be sent beyond the byte acknowledged. 
	- This number, is called **window advertisement**, can increase or decrease as needed. 
	- A value of zero closes the window altogether. 
- Checksum (16 bits) 
	- Applies to the entire segment and a pseudo-header. 
	- The pseudo-header contains the following IP header fields: 
		- Source IP address, destination IP address, protocol, segment length. 
		- TCP protects itself from misdelivery by IP (delivered to wrong host). 
	- Same algorithm as used in IP.
## TCP Connection Establishment 
### 3-Way handshake
![[Pasted image 20250825035755.png]]
## Half-Open (Incomplete) Connection
![[Pasted image 20250825035835.png]]
#### Possible attack scenario : 
- Create many half-open connections to target. 
- Ignore SYN+ACK response
- Target connection table fills up, resulting in denial-of-service (DoS) attack.
## TCP Connection Termination : 
![[Pasted image 20250825040022.png]]

## Format of UDP segment (8 bytes header)
![[Pasted image 20250825040109.png]]
### UDP Header Fields 
- Source port (16 bits) 
	- identifies the process at the local end. 
- Destination port (16 bits )
	-  identifies the process at the remote end. 
- Message length (16 bits ) 
	- Specifies the size of the datagram in bytes (UDP header plus data). 
- Checksum (16 bits )
	- Computed in the same way as TCP. 
	- This is optional; set to zero if not used. 